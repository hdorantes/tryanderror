import json
import openai
from flask import Flask, request, jsonify

openai.api_key = "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"

def extract_ids(string):
    try:
        data = json.loads(string)
        ids = [item["id"] for item in data]
        return ids
    except (json.JSONDecodeError, KeyError):
        return []

def find_matching_data(ids, json_data):
    try:
        data = json.loads(json_data)
        matching_data = [item for item in data["data"] if item["id"] in ids]
        return matching_data
    except (json.JSONDecodeError, KeyError):
        return []


app = Flask(__name__)

@app.route('/api', methods=['POST'])
def process_request():
    # Extract request data
    request_data = request.json
    prompt = request_data.get('prompt')
    base_prompt= """
        I am a vehicle search engine. I will search vehicle based on following json input data. The model should iterate through the input json data, look for value of the json property and if it find any match then return that particular vehicle id in json format. If it does not find any match for a request, it should return an empty json data. For example, if I search for all blue color vehicle, it should iterate through the json input data, look for exterior_color property and return if it find a value blue. Similarly, if I search for vehicle with certain mileage, it should iterate through the json data, check mileage property and compare if the requested mileage is falling into that range or not, if it find a match return the vehicle id otherwise return empty json. ###
        Input data: ###
        {"data":[{"id":"-5895671319161974787","make":"Chevrolet","model":"Silverado 1500","body_style":"Pickup","exterior_color":"Black","vehicle_condition":"Used","year":2022,"mileage":19398,"price":48950},{"id":"5026406780478686116","make":"Infiniti","model":"QX60","body_style":"SUV","exterior_color":"Black","vehicle_condition":"CPO","year":2020,"mileage":23247,"price":36999},{"id":"314626933687442901","make":"Infiniti","model":"QX80","body_style":"SUV","exterior_color":"White","vehicle_condition":"Used","year":2022,"mileage":14814,"price":68900},{"id":"-4360754388345081817","make":"Ford","model":"Explorer","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"Used","year":2020,"mileage":54569,"price":29973},{"id":"3717886903242235128","make":"Audi","model":"Q5","body_style":"SUV","exterior_color":"Silver","vehicle_condition":"Used","year":2021,"mileage":44001,"price":33969},{"id":"-8362009517356480123","make":"Kia","model":"Sorento","body_style":"SUV","exterior_color":"White","vehicle_condition":"CPO","year":2021,"mileage":58038,"price":25390},{"id":"-2286512900667743883","make":"Acura","model":"RDX","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"Used","year":2014,"mileage":103323,"price":17995},{"id":"4097034971705450232","make":"Mercedes-Benz","model":"GLE","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"Used","year":2020,"mileage":42176,"price":47999},{"id":"1803309884288364858","make":"GMC","model":"Terrain","body_style":"SUV","exterior_color":"White","vehicle_condition":"Used","year":2020,"mileage":60375,"price":25927},{"id":"7075332948536924587","make":"Jeep","model":"Cherokee","body_style":"SUV","exterior_color":"Red","vehicle_condition":"Used","year":2019,"mileage":56000,"price":21708},{"id":"7332810984067662190","make":"Honda","model":"CR-V","body_style":"SUV","exterior_color":"Red","vehicle_condition":"Used","year":2018,"mileage":98768,"price":23292},{"id":"4492267905857148706","make":"Honda","model":"Civic","body_style":"Coupe","exterior_color":"Black","vehicle_condition":"Used","year":2013,"mileage":104621,"price":12000},{"id":"-8205942642902667925","make":"Mercedes-Benz","model":"GLS","body_style":"SUV","exterior_color":"Silver","vehicle_condition":"Used","year":2020,"mileage":16253,"price":67800},{"id":"-2724725936011478536","make":"Infiniti","model":"QX80","body_style":"SUV","exterior_color":"Black","vehicle_condition":"Used","year":2016,"mileage":100414,"price":25499},{"id":"7646580422848858957","make":"Jeep","model":"Wrangler","body_style":"SUV","exterior_color":"Yellow","vehicle_condition":"Used","year":2019,"mileage":27918,"price":40998},{"id":"739322256270036901","make":"Toyota","model":"Corolla","body_style":"Hatchback","exterior_color":"Silver","vehicle_condition":"Used","year":2023,"mileage":5806,"price":25498},{"id":"5091859666035390759","make":"BMW","model":"3 Series","body_style":"Sedan","exterior_color":"Gray","vehicle_condition":"Used","year":2013,"mileage":99257,"price":11000},{"id":"-2441138484280971621","make":"Ford","model":"F-150","body_style":"Pickup","exterior_color":"Silver","vehicle_condition":"Used","year":2019,"mileage":78431,"price":35973},{"id":"-5336922274807791315","make":"Chevrolet","model":"Equinox","body_style":"SUV","exterior_color":"Silver","vehicle_condition":"CPO","year":2020,"mileage":13015,"price":26000},{"id":"5812709785351450485","make":"Chevrolet","model":"Colorado","body_style":"Pickup","exterior_color":"Blue","vehicle_condition":"Used","year":2020,"mileage":75150,"price":22577},{"id":"-6621809372632440308","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"New","year":2023,"mileage":2,"price":46811},{"id":"3279770836407204030","make":"Jeep","model":"Wagoneer","body_style":"SUV","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":4,"price":83122},{"id":"-4560067317642147256","make":"Ram","model":"1500","body_style":"Pickup","exterior_color":"White","vehicle_condition":"New","year":2023,"mileage":2,"price":77950},{"id":"-446043432847313615","make":"Chevrolet","model":"Bolt EUV","body_style":"SUV","exterior_color":"Blue","vehicle_condition":"New","year":2023,"mileage":2,"price":35790},{"id":"-4818566526041497498","make":"Jeep","model":"Gladiator","body_style":"Pickup","exterior_color":"Red","vehicle_condition":"New","year":2023,"mileage":10,"price":51790},{"id":"-3801414670992030520","make":"Jeep","model":"Grand Cherokee","body_style":"SUV","exterior_color":"Red","vehicle_condition":"New","year":2023,"mileage":5,"price":47430},{"id":"-2993940710374281343","make":"Ram","model":"1500","body_style":"Pickup","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":5,"price":101180},{"id":"-5748446695895238691","make":"Honda","model":"CR-V","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"New","year":2023,"mileage":7,"price":35876},{"id":"3076293490382211747","make":"Subaru","model":"Forester","body_style":"SUV","exterior_color":"Green","vehicle_condition":"New","year":2023,"mileage":5,"price":38911},{"id":"4188919248409693870","make":"GMC","model":"Sierra 1500","body_style":"Pickup","exterior_color":"White","vehicle_condition":"New","year":2023,"mileage":2,"price":42925},{"id":"4842373748135033396","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"Silver","vehicle_condition":"New","year":2023,"mileage":2,"price":46655},{"id":"4597235982606416850","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"Green","vehicle_condition":"New","year":2023,"mileage":8,"price":42520},{"id":"2423554251870492633","make":"Subaru","model":"Outback","body_style":"Wagon","exterior_color":"Blue","vehicle_condition":"New","year":2024,"mileage":7,"price":42700},{"id":"3644084718618933067","make":"Ram","model":"1500","body_style":"Pickup","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":10,"price":59783},{"id":"-6948266371532344148","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"White","vehicle_condition":"New","year":2023,"mileage":2,"price":48346},{"id":"7650363564363900831","make":"Dodge","model":"Challenger","body_style":"Coupe","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":5,"price":30800},{"id":"3870581139470513735","make":"Chevrolet","model":"Suburban","body_style":"SUV","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":1,"price":83910},{"id":"-5919058550258187097","make":"Kia","model":"Soul","body_style":"Wagon","exterior_color":"Gray","vehicle_condition":"New","year":2023,"mileage":4,"price":26135},{"id":"-4855587414577851613","make":"Kia","model":"EV6","body_style":"SUV","exterior_color":"Blue","vehicle_condition":"New","year":2023,"mileage":15,"price":50550},{"id":"-5511671246644678398","make":"GMC","model":"Canyon","body_style":"Pickup","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":2,"price":54805},{"id":"-8547364095261535065","make":"Kia","model":"Forte","body_style":"Sedan","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":3,"price":21110},{"id":"-5479797038400680541","make":"Kia","model":"Niro","body_style":"SUV","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":3,"price":28670},{"id":"3667649575214948866","make":"Kia","model":"Forte","body_style":"Sedan","exterior_color":"Orange","vehicle_condition":"New","year":2023,"mileage":9,"price":21315},{"id":"-8015072294543079780","make":"Chevrolet","model":"Equinox","body_style":"SUV","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":3,"price":28780},{"id":"6455081926515488390","make":"Jeep","model":"Grand Cherokee","body_style":"SUV","exterior_color":"Red","vehicle_condition":"New","year":2023,"mileage":12,"price":40037},{"id":"8722176513116598104","make":"Infiniti","model":"QX80","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"New","year":2023,"mileage":5,"price":90560},{"id":"3509559560612406876","make":"GMC","model":"Sierra 1500","body_style":"Pickup","exterior_color":"Red","vehicle_condition":"New","year":2023,"mileage":3,"price":50545},{"id":"-6501130464567925283","make":"Subaru","model":"Outback","body_style":"Wagon","exterior_color":"Gray","vehicle_condition":"New","year":2024,"mileage":7,"price":33280},{"id":"9097664163304538951","make":"Subaru","model":"Forester","body_style":"SUV","exterior_color":"Blue","vehicle_condition":"New","year":2023,"mileage":5,"price":38911},{"id":"3734425774397692385","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"Red","vehicle_condition":"New","year":2023,"mileage":2,"price":51131},{"id":"-7153817088100806555","make":"Subaru","model":"Forester","body_style":"SUV","exterior_color":"Green","vehicle_condition":"New","year":2023,"mileage":3,"price":39747},{"id":"4597991649198143926","make":"Volkswagen","model":"Jetta","body_style":"Sedan","exterior_color":"White","vehicle_condition":"Used","year":2020,"mileage":43299,"price":21477},{"id":"8695736304169807392","make":"Subaru","model":"Forester","body_style":"SUV","exterior_color":"Blue","vehicle_condition":"CPO","year":2022,"mileage":11692,"price":29043},{"id":"-6179833972011787469","make":"Subaru","model":"Outback","body_style":"Wagon","exterior_color":"Black","vehicle_condition":"Used","year":2020,"mileage":23615,"price":35000},{"id":"8195537461656882956","make":"Toyota","model":"4Runner","body_style":"SUV","exterior_color":"Silver","vehicle_condition":"Used","year":2021,"mileage":43066,"price":38739},{"id":"-274458240007713452","make":"Mitsubishi","model":"Outlander Sport","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"CPO","year":2021,"mileage":35868,"price":19989},{"id":"-8977175611041292638","make":"BMW","model":"8 Series","body_style":"Sedan","exterior_color":"White","vehicle_condition":"Used","year":2022,"mileage":8821,"price":71990},{"id":"-8607259219994949633","make":"Dodge","model":"Charger","body_style":"Sedan","exterior_color":"Purple","vehicle_condition":"Used","year":2016,"mileage":39566,"price":26995},{"id":"-3056009774971440370","make":"Nissan","model":"Pathfinder","body_style":"SUV","exterior_color":"White","vehicle_condition":"Used","year":2019,"mileage":75359,"price":20489},{"id":"-4280757674748995982","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"Brown","vehicle_condition":"CPO","year":2020,"mileage":25170,"price":38991}]}
        Response format: ###
        [{"id": <String>}] ###

        Q: show me all orange car ###
        [{"id":"-7932487686042285633"}]

        Q: show me all car price between 67225 and 67235 ###
        [{"id":"-4477316342679034490"}]

        Q: show me all red car with mileage between 15 and 19 ###
        [{"id":"-6701557851749527305"}] 
        """;
    new_prompt = base_prompt + "\nQ: " + prompt + ' ###'

    response = openai.Completion.create(
        model="text-davinci-003",
        prompt=new_prompt,
        temperature=0.7,
        max_tokens=100,
        top_p=0.7,
        frequency_penalty=0.0,
        presence_penalty=0.0
    )    
    print ("Response from OpenAI=",response);
    # Extract relevant information from OpenAI response
    vechile_response = response['choices'][0]['text']
    vechile_ids = extract_ids (vechile_response)
    print ("Vehicle ids=", vechile_ids)
    json_data = """
        {"data":[{"id":"-5895671319161974787","make":"Chevrolet","model":"Silverado 1500","body_style":"Pickup","exterior_color":"Black","vehicle_condition":"Used","year":2022,"mileage":19398,"price":48950,"dealer":{"name":"Vandergriff Toyota","country":"United States","state":"TX","city":"Arlington","zip":"76017","street":"1000 W I - 20","distance":34},"image":"https://img.vast.com/apollo/-5895671319161974787/1/640x-"},{"id":"5026406780478686116","make":"Infiniti","model":"QX60","body_style":"SUV","exterior_color":"Black","vehicle_condition":"CPO","year":2020,"mileage":23247,"price":36999,"dealer":{"name":"Grubbs INFINITI","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"1500 E State Highway 114","distance":18},"image":"https://img.vast.com/apollo/5026406780478686116/1/640x-"},{"id":"314626933687442901","make":"Infiniti","model":"QX80","body_style":"SUV","exterior_color":"White","vehicle_condition":"Used","year":2022,"mileage":14814,"price":68900,"dealer":{"name":"Classic Chevrolet Grapevine","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"1101 State Highway 114","distance":19},"image":"https://img.vast.com/apollo/314626933687442901/1/640x-"},{"id":"-4360754388345081817","make":"Ford","model":"Explorer","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"Used","year":2020,"mileage":54569,"price":29973,"dealer":{"name":"HCS Mesquite","country":"United States","state":"TX","city":"Dallas","zip":"75228","street":"8640 E R L Thornton Freeway","distance":20},"image":"https://img.vast.com/apollo/-4360754388345081817/1/640x-"},{"id":"3717886903242235128","make":"Audi","model":"Q5","body_style":"SUV","exterior_color":"Silver","vehicle_condition":"Used","year":2021,"mileage":44001,"price":33969,"dealer":{"name":"EchoPark Automotive Dallas","country":"United States","state":"TX","city":"Grand Prairie","zip":"75052","street":"2615 W I20 Frontage Road","distance":30},"image":"https://img.vast.com/apollo/3717886903242235128/1/640x-"},{"id":"-8362009517356480123","make":"Kia","model":"Sorento","body_style":"SUV","exterior_color":"White","vehicle_condition":"CPO","year":2021,"mileage":58038,"price":25390,"dealer":{"name":"Southwest Kia","country":"United States","state":"TX","city":"Mesquite","zip":"75150","street":"1919 Oates Drive","distance":19},"image":"https://img.vast.com/apollo/-8362009517356480123/1/640x-"},{"id":"-2286512900667743883","make":"Acura","model":"RDX","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"Used","year":2014,"mileage":103323,"price":17995,"dealer":{"name":"Grapevine Honda","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"2301 William D Tate Avenue","distance":20},"image":"https://img.vast.com/apollo/-2286512900667743883/1/640x-"},{"id":"4097034971705450232","make":"Mercedes-Benz","model":"GLE","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"Used","year":2020,"mileage":42176,"price":47999,"dealer":{"name":"Grubbs Volvo Cars Grapevine","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"1500 E State Highway 114","distance":18},"image":"https://img.vast.com/apollo/4097034971705450232/1/640x-"},{"id":"1803309884288364858","make":"GMC","model":"Terrain","body_style":"SUV","exterior_color":"White","vehicle_condition":"Used","year":2020,"mileage":60375,"price":25927,"dealer":{"name":"Freeman Grapevine","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"501 Highway 114 West","distance":19},"image":"https://img.vast.com/apollo/1803309884288364858/1/640x-"},{"id":"7075332948536924587","make":"Jeep","model":"Cherokee","body_style":"SUV","exterior_color":"Red","vehicle_condition":"Used","year":2019,"mileage":56000,"price":21708,"dealer":{"name":"Denton Chrysler Dodge Jeep Ram","country":"United States","state":"TX","city":"Denton","zip":"76210","street":"4984 S Interstate 35 East","distance":16},"image":"https://img.vast.com/apollo/7075332948536924587/1/640x-"},{"id":"7332810984067662190","make":"Honda","model":"CR-V","body_style":"SUV","exterior_color":"Red","vehicle_condition":"Used","year":2018,"mileage":98768,"price":23292,"dealer":{"name":"Toyota of Richardson","country":"United States","state":"TX","city":"Richardson","zip":"75080","street":"1221 N Central Expressway","distance":8},"image":"https://img.vast.com/apollo/7332810984067662190/1/640x-"},{"id":"4492267905857148706","make":"Honda","model":"Civic","body_style":"Coupe","exterior_color":"Black","vehicle_condition":"Used","year":2013,"mileage":104621,"price":12000,"dealer":{"name":"Five Star Subaru","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"2651 William D Tate Avenue","distance":20},"image":"https://img.vast.com/apollo/4492267905857148706/1/640x-"},{"id":"-8205942642902667925","make":"Mercedes-Benz","model":"GLS","body_style":"SUV","exterior_color":"Silver","vehicle_condition":"Used","year":2020,"mileage":16253,"price":67800,"dealer":{"name":"Heritage Buick GMC","country":"United States","state":"TX","city":"Rockwall","zip":"75087","street":"930 E I-30","distance":22},"image":"https://img.vast.com/apollo/-8205942642902667925/1/640x-"},{"id":"-2724725936011478536","make":"Infiniti","model":"QX80","body_style":"SUV","exterior_color":"Black","vehicle_condition":"Used","year":2016,"mileage":100414,"price":25499,"dealer":{"name":"Grubbs INFINITI","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"1500 E State Highway 114","distance":18},"image":"https://img.vast.com/apollo/-2724725936011478536/1/640x-"},{"id":"7646580422848858957","make":"Jeep","model":"Wrangler","body_style":"SUV","exterior_color":"Yellow","vehicle_condition":"Used","year":2019,"mileage":27918,"price":40998,"dealer":{"name":"Forest Lane Chrysler Dodge Jeep Ram","country":"United States","state":"TX","city":"Dallas","zip":"75234","street":"2536 Forest Lane","distance":12},"image":"https://img.vast.com/apollo/7646580422848858957/1/640x-"},{"id":"739322256270036901","make":"Toyota","model":"Corolla","body_style":"Hatchback","exterior_color":"Silver","vehicle_condition":"Used","year":2023,"mileage":5806,"price":25498,"dealer":{"name":"Norm Reeves Subaru Rockwall","country":"United States","state":"TX","city":"Rockwall","zip":"75087","street":"1501 E Interstate 30","distance":21},"image":"https://img.vast.com/apollo/739322256270036901/1/640x-"},{"id":"5091859666035390759","make":"BMW","model":"3 Series","body_style":"Sedan","exterior_color":"Gray","vehicle_condition":"Used","year":2013,"mileage":99257,"price":11000,"dealer":{"name":"Classic Chevrolet Grapevine","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"1101 State Highway 114","distance":19},"image":"https://img.vast.com/apollo/5091859666035390759/1/640x-"},{"id":"-2441138484280971621","make":"Ford","model":"F-150","body_style":"Pickup","exterior_color":"Silver","vehicle_condition":"Used","year":2019,"mileage":78431,"price":35973,"dealer":{"name":"Frisco Chrysler Dodge Jeep Ram","country":"United States","state":"TX","city":"Frisco","zip":"75035","street":"9640 State Highway 121","distance":1},"image":"https://img.vast.com/apollo/-2441138484280971621/1/640x-"},{"id":"-5336922274807791315","make":"Chevrolet","model":"Equinox","body_style":"SUV","exterior_color":"Silver","vehicle_condition":"CPO","year":2020,"mileage":13015,"price":26000,"dealer":{"name":"Classic Chevrolet Grapevine","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"1101 State Highway 114","distance":19},"image":"https://img.vast.com/apollo/-5336922274807791315/1/640x-"},{"id":"5812709785351450485","make":"Chevrolet","model":"Colorado","body_style":"Pickup","exterior_color":"Blue","vehicle_condition":"Used","year":2020,"mileage":75150,"price":22577,"dealer":{"name":"Huffines Chevrolet","country":"United States","state":"TX","city":"Lewisville","zip":"75067","street":"1400 S Stemmons","distance":11},"image":"https://img.vast.com/apollo/5812709785351450485/1/640x-"},{"id":"-6621809372632440308","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"New","year":2023,"mileage":2,"price":46811,"dealer":{"name":"Norm Reeves Subaru Rockwall","country":"United States","state":"TX","city":"Rockwall","zip":"75087","street":"1501 E Interstate 30","distance":21},"image":"https://img.vast.com/apollo/-6621809372632440308/1/640x-"},{"id":"3279770836407204030","make":"Jeep","model":"Wagoneer","body_style":"SUV","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":4,"price":83122,"dealer":{"name":"Frisco Chrysler Dodge Jeep Ram","country":"United States","state":"TX","city":"Frisco","zip":"75035","street":"9640 State Highway 121","distance":1},"image":"https://img.vast.com/apollo/3279770836407204030/1/640x-"},{"id":"-4560067317642147256","make":"Ram","model":"1500","body_style":"Pickup","exterior_color":"White","vehicle_condition":"New","year":2023,"mileage":2,"price":77950,"dealer":{"name":"Mortiz Chevrolet Chrysler Jeep Dodge Ram","country":"United States","state":"TX","city":"Fort Worth","zip":"76116","street":"9101 Camp Bowie West","distance":44},"image":"https://img.vast.com/apollo/-4560067317642147256/1/640x-"},{"id":"-446043432847313615","make":"Chevrolet","model":"Bolt EUV","body_style":"SUV","exterior_color":"Blue","vehicle_condition":"New","year":2023,"mileage":2,"price":35790,"dealer":{"name":"Classic Chevrolet Grapevine","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"1101 State Highway 114","distance":19},"image":"https://img.vast.com/apollo/-446043432847313615/1/640x-"},{"id":"-4818566526041497498","make":"Jeep","model":"Gladiator","body_style":"Pickup","exterior_color":"Red","vehicle_condition":"New","year":2023,"mileage":10,"price":51790,"dealer":{"name":"Frisco Chrysler Dodge Jeep Ram","country":"United States","state":"TX","city":"Frisco","zip":"75035","street":"9640 State Highway 121","distance":1},"image":"https://img.vast.com/apollo/-4818566526041497498/1/640x-"},{"id":"-3801414670992030520","make":"Jeep","model":"Grand Cherokee","body_style":"SUV","exterior_color":"Red","vehicle_condition":"New","year":2023,"mileage":5,"price":47430,"dealer":{"name":"Dallas Dodge Chrysler Jeep","country":"United States","state":"TX","city":"Dallas","zip":"75238","street":"11550 Lbj Freeway","distance":14},"image":"https://img.vast.com/apollo/-3801414670992030520/1/640x-"},{"id":"-2993940710374281343","make":"Ram","model":"1500","body_style":"Pickup","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":5,"price":101180,"dealer":{"name":"Dallas Dodge Chrysler Jeep","country":"United States","state":"TX","city":"Dallas","zip":"75238","street":"11550 Lbj Freeway","distance":14},"image":"https://img.vast.com/apollo/-2993940710374281343/1/640x-"},{"id":"-5748446695895238691","make":"Honda","model":"CR-V","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"New","year":2023,"mileage":7,"price":35876,"dealer":{"name":"Freeman Honda","country":"United States","state":"TX","city":"Dallas","zip":"75237","street":"39680 Highway 20","distance":28},"image":"https://img.vast.com/apollo/-5748446695895238691/1/640x-"},{"id":"3076293490382211747","make":"Subaru","model":"Forester","body_style":"SUV","exterior_color":"Green","vehicle_condition":"New","year":2023,"mileage":5,"price":38911,"dealer":{"name":"Huffines Subaru","country":"United States","state":"TX","city":"Corinth","zip":"76210","street":"6930 S Interstate 35 East","distance":15},"image":"https://img.vast.com/apollo/3076293490382211747/1/640x-"},{"id":"4188919248409693870","make":"GMC","model":"Sierra 1500","body_style":"Pickup","exterior_color":"White","vehicle_condition":"New","year":2023,"mileage":2,"price":42925,"dealer":{"name":"Freeman Grapevine","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"501 Highway 114 West","distance":19},"image":"https://img.vast.com/apollo/4188919248409693870/1/640x-"},{"id":"4842373748135033396","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"Silver","vehicle_condition":"New","year":2023,"mileage":2,"price":46655,"dealer":{"name":"Norm Reeves Subaru Rockwall","country":"United States","state":"TX","city":"Rockwall","zip":"75087","street":"1501 E Interstate 30","distance":21},"image":"https://img.vast.com/apollo/4842373748135033396/1/640x-"},{"id":"4597235982606416850","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"Green","vehicle_condition":"New","year":2023,"mileage":8,"price":42520,"dealer":{"name":"Ewing Subaru Plano","country":"United States","state":"TX","city":"Plano","zip":"75093","street":"1555 Dallas Parkway","distance":4},"image":"https://img.vast.com/apollo/4597235982606416850/1/640x-"},{"id":"2423554251870492633","make":"Subaru","model":"Outback","body_style":"Wagon","exterior_color":"Blue","vehicle_condition":"New","year":2024,"mileage":7,"price":42700,"dealer":{"name":"Brandon Tomes Subaru","country":"United States","state":"TX","city":"McKinney","zip":"75070","street":"1100 S Central Expressway","distance":11},"image":"https://img.vast.com/apollo/2423554251870492633/1/640x-"},{"id":"3644084718618933067","make":"Ram","model":"1500","body_style":"Pickup","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":10,"price":59783,"dealer":{"name":"Frisco Chrysler Dodge Jeep Ram","country":"United States","state":"TX","city":"Frisco","zip":"75035","street":"9640 State Highway 121","distance":1},"image":"https://img.vast.com/apollo/3644084718618933067/1/640x-"},{"id":"-6948266371532344148","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"White","vehicle_condition":"New","year":2023,"mileage":2,"price":48346,"dealer":{"name":"Norm Reeves Subaru Rockwall","country":"United States","state":"TX","city":"Rockwall","zip":"75087","street":"1501 E Interstate 30","distance":21},"image":"https://img.vast.com/apollo/-6948266371532344148/1/640x-"},{"id":"7650363564363900831","make":"Dodge","model":"Challenger","body_style":"Coupe","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":5,"price":30800,"dealer":{"name":"Dallas Dodge Chrysler Jeep","country":"United States","state":"TX","city":"Dallas","zip":"75238","street":"11550 Lbj Freeway","distance":14},"image":"https://img.vast.com/apollo/7650363564363900831/1/640x-"},{"id":"3870581139470513735","make":"Chevrolet","model":"Suburban","body_style":"SUV","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":1,"price":83910,"dealer":{"name":"Lakeside Chevrolet","country":"United States","state":"TX","city":"Rockwall","zip":"75087","street":"2005 S Goliad Street","distance":23},"image":"https://img.vast.com/apollo/3870581139470513735/1/640x-"},{"id":"-5919058550258187097","make":"Kia","model":"Soul","body_style":"Wagon","exterior_color":"Gray","vehicle_condition":"New","year":2023,"mileage":4,"price":26135,"dealer":{"name":"Southwest Kia","country":"United States","state":"TX","city":"Rockwall","zip":"75087","street":"1790 E I30","distance":21},"image":"https://img.vast.com/apollo/-5919058550258187097/1/640x-"},{"id":"-4855587414577851613","make":"Kia","model":"EV6","body_style":"SUV","exterior_color":"Blue","vehicle_condition":"New","year":2023,"mileage":15,"price":50550,"dealer":{"name":"Huffines Kia Denton","country":"United States","state":"TX","city":"Corinth","zip":"76210","street":"6940 S I 35E","distance":15},"image":"https://img.vast.com/apollo/-4855587414577851613/1/640x-"},{"id":"-5511671246644678398","make":"GMC","model":"Canyon","body_style":"Pickup","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":2,"price":54805,"dealer":{"name":"Freeman Grapevine","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"501 Highway 114 West","distance":19},"image":"https://img.vast.com/apollo/-5511671246644678398/1/640x-"},{"id":"-8547364095261535065","make":"Kia","model":"Forte","body_style":"Sedan","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":3,"price":21110,"dealer":{"name":"Huffines Kia McKinney","country":"United States","state":"TX","city":"McKinney","zip":"75070","street":"1201 Nc Expressway","distance":9},"image":"https://img.vast.com/apollo/-8547364095261535065/1/640x-"},{"id":"-5479797038400680541","make":"Kia","model":"Niro","body_style":"SUV","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":3,"price":28670,"dealer":{"name":"Huffines Kia McKinney","country":"United States","state":"TX","city":"McKinney","zip":"75070","street":"1201 Nc Expressway","distance":9},"image":"https://img.vast.com/apollo/-5479797038400680541/1/640x-"},{"id":"3667649575214948866","make":"Kia","model":"Forte","body_style":"Sedan","exterior_color":"Orange","vehicle_condition":"New","year":2023,"mileage":9,"price":21315,"dealer":{"name":"Huffines Kia Denton","country":"United States","state":"TX","city":"Corinth","zip":"76210","street":"6940 S I 35E","distance":15},"image":"https://img.vast.com/apollo/3667649575214948866/1/640x-"},{"id":"-8015072294543079780","make":"Chevrolet","model":"Equinox","body_style":"SUV","exterior_color":"Black","vehicle_condition":"New","year":2023,"mileage":3,"price":28780,"dealer":{"name":"Lakeside Chevrolet","country":"United States","state":"TX","city":"Rockwall","zip":"75087","street":"2005 S Goliad Street","distance":23},"image":"https://img.vast.com/apollo/-8015072294543079780/1/640x-"},{"id":"6455081926515488390","make":"Jeep","model":"Grand Cherokee","body_style":"SUV","exterior_color":"Red","vehicle_condition":"New","year":2023,"mileage":12,"price":40037,"dealer":{"name":"Dallas Dodge Chrysler Jeep","country":"United States","state":"TX","city":"Dallas","zip":"75238","street":"11550 Lbj Freeway","distance":14},"image":"https://img.vast.com/apollo/6455081926515488390/1/640x-"},{"id":"8722176513116598104","make":"Infiniti","model":"QX80","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"New","year":2023,"mileage":5,"price":90560,"dealer":{"name":"Grubbs INFINITI","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"1500 E State Highway 114","distance":18},"image":"https://img.vast.com/apollo/8722176513116598104/1/640x-"},{"id":"3509559560612406876","make":"GMC","model":"Sierra 1500","body_style":"Pickup","exterior_color":"Red","vehicle_condition":"New","year":2023,"mileage":3,"price":50545,"dealer":{"name":"Classic Buick GMC","country":"United States","state":"TX","city":"Arlington","zip":"76018","street":"1400 E I-20","distance":32},"image":"https://img.vast.com/apollo/3509559560612406876/1/640x-"},{"id":"-6501130464567925283","make":"Subaru","model":"Outback","body_style":"Wagon","exterior_color":"Gray","vehicle_condition":"New","year":2024,"mileage":7,"price":33280,"dealer":{"name":"Brandon Tomes Subaru","country":"United States","state":"TX","city":"McKinney","zip":"75070","street":"1100 S Central Expressway","distance":11},"image":"https://img.vast.com/apollo/-6501130464567925283/1/640x-"},{"id":"9097664163304538951","make":"Subaru","model":"Forester","body_style":"SUV","exterior_color":"Blue","vehicle_condition":"New","year":2023,"mileage":5,"price":38911,"dealer":{"name":"Huffines Subaru","country":"United States","state":"TX","city":"Corinth","zip":"76210","street":"6930 S Interstate 35 East","distance":15},"image":"https://img.vast.com/apollo/9097664163304538951/1/640x-"},{"id":"3734425774397692385","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"Red","vehicle_condition":"New","year":2023,"mileage":2,"price":51131,"dealer":{"name":"Norm Reeves Subaru Rockwall","country":"United States","state":"TX","city":"Rockwall","zip":"75087","street":"1501 E Interstate 30","distance":21},"image":"https://img.vast.com/apollo/3734425774397692385/1/640x-"},{"id":"-7153817088100806555","make":"Subaru","model":"Forester","body_style":"SUV","exterior_color":"Green","vehicle_condition":"New","year":2023,"mileage":3,"price":39747,"dealer":{"name":"Norm Reeves Subaru Rockwall","country":"United States","state":"TX","city":"Rockwall","zip":"75087","street":"1501 E Interstate 30","distance":21},"image":"https://img.vast.com/apollo/-7153817088100806555/1/640x-"},{"id":"4597991649198143926","make":"Volkswagen","model":"Jetta","body_style":"Sedan","exterior_color":"White","vehicle_condition":"Used","year":2020,"mileage":43299,"price":21477,"dealer":{"name":"Huffines Kia Denton","country":"United States","state":"TX","city":"Corinth","zip":"76210","street":"6940 S I 35E","distance":15},"image":"https://img.vast.com/apollo/4597991649198143926/1/640x-"},{"id":"8695736304169807392","make":"Subaru","model":"Forester","body_style":"SUV","exterior_color":"Blue","vehicle_condition":"CPO","year":2022,"mileage":11692,"price":29043,"dealer":{"name":"Norm Reeves Subaru Rockwall","country":"United States","state":"TX","city":"Rockwall","zip":"75087","street":"1501 E Interstate 30","distance":21},"image":"https://img.vast.com/apollo/8695736304169807392/1/640x-"},{"id":"-6179833972011787469","make":"Subaru","model":"Outback","body_style":"Wagon","exterior_color":"Black","vehicle_condition":"Used","year":2020,"mileage":23615,"price":35000,"dealer":{"name":"Five Star Subaru","country":"United States","state":"TX","city":"Grapevine","zip":"76051","street":"2651 William D Tate Avenue","distance":20},"image":"https://img.vast.com/apollo/-6179833972011787469/1/640x-"},{"id":"8195537461656882956","make":"Toyota","model":"4Runner","body_style":"SUV","exterior_color":"Silver","vehicle_condition":"Used","year":2021,"mileage":43066,"price":38739,"dealer":{"name":"EchoPark Automotive Dallas","country":"United States","state":"TX","city":"Grand Prairie","zip":"75052","street":"2615 W I20 Frontage Road","distance":30},"image":"https://img.vast.com/apollo/8195537461656882956/1/640x-"},{"id":"-274458240007713452","make":"Mitsubishi","model":"Outlander Sport","body_style":"SUV","exterior_color":"Gray","vehicle_condition":"CPO","year":2021,"mileage":35868,"price":19989,"dealer":{"name":"Avis Car Sales Irving","country":"United States","state":"TX","city":"Irving","zip":"75062","street":"1600 E Airport Freeway","distance":17},"image":"https://img.vast.com/apollo/-274458240007713452/1/640x-"},{"id":"-8977175611041292638","make":"BMW","model":"8 Series","body_style":"Sedan","exterior_color":"White","vehicle_condition":"Used","year":2022,"mileage":8821,"price":71990,"dealer":{"name":"Alfa Romeo of Plano","country":"United States","state":"TX","city":"Plano","zip":"75093","street":"4472 W Plano Parkway","distance":4},"image":"https://img.vast.com/apollo/-8977175611041292638/1/640x-"},{"id":"-8607259219994949633","make":"Dodge","model":"Charger","body_style":"Sedan","exterior_color":"Purple","vehicle_condition":"Used","year":2016,"mileage":39566,"price":26995,"dealer":{"name":"Mortiz Chevrolet Chrysler Jeep Dodge Ram","country":"United States","state":"TX","city":"Fort Worth","zip":"76116","street":"9101 Camp Bowie West","distance":44},"image":"https://img.vast.com/apollo/-8607259219994949633/1/640x-"},{"id":"-3056009774971440370","make":"Nissan","model":"Pathfinder","body_style":"SUV","exterior_color":"White","vehicle_condition":"Used","year":2019,"mileage":75359,"price":20489,"dealer":{"name":"EchoPark Automotive Dallas","country":"United States","state":"TX","city":"Grand Prairie","zip":"75052","street":"2615 W I20 Frontage Road","distance":30},"image":"https://img.vast.com/apollo/-3056009774971440370/1/640x-"},{"id":"-4280757674748995982","make":"Subaru","model":"Ascent","body_style":"SUV","exterior_color":"Brown","vehicle_condition":"CPO","year":2020,"mileage":25170,"price":38991,"dealer":{"name":"Sewell Subaru","country":"United States","state":"TX","city":"Dallas","zip":"75209","street":"7800 Lemmon Avenue","distance":15},"image":"https://img.vast.com/apollo/-4280757674748995982/1/640x-"}]}
        """
    vechiles = find_matching_data(vechile_ids, json_data)
    # # Prepare and return the response
    # response = {
    #     'vin': parsed_data.get('vin'),
    #     'make': parsed_data.get('make'),
    #     'model': parsed_data.get('model'),
    #     'trim': parsed_data.get('trim'),
    #     'body_style': parsed_data.get('body_style'),
    #     'dealer': {
    #         'name': parsed_data.get('dealer', {}).get('name')
    #     }
    # }

    return jsonify(vechiles), 200

def extract_ids(string):
    try:
        data = json.loads(string)
        ids = [item["id"] for item in data]
        return ids
    except (json.JSONDecodeError, KeyError):
        return []

if __name__ == '__main__':
    app.run()
